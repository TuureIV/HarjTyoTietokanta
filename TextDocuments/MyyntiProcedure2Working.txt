DELIMITER $$
CREATE PROCEDURE `Myynti` (
IN CN VARCHAR(45),
IN BarCod VARCHAR(45),
IN Regis VARCHAR(45),
IN Emp VARCHAR(45))

BEGIN
DECLARE IDsell INT DEFAULT 0;
DECLARE PrNm INT DEFAULT 0;
DECLARE PrID INT DEFAULT 0;
DECLARE PrPrice INT DEFAULT 0;
DECLARE Size INT DEFAULT 0;

SELECT IDAsiakasnumero INTO CN FROM KantaAsiakas;
SELECT IDTuote INTO PrID FROM Tuoteryhma;
SELECT Hinta INTO PrPrice FROM Tuoteryhma WHERE Tuotenimi=PrNm;
SELECT IDViivakoodi INTO BarCod FROM Tuote WHERE TuoteID=PrID;
SELECT Tuotenimi INTO PrNm FROM Tuoteryhma WHERE IDTuote=PrID;
SELECT Koko INTO Size FROM Tuote WHERE IDViivakoodi=BarCod;

SELECT IDosto INTO IDsell FROM Ostotapahtuma WHERE Kassa=Regis AND Myyjä=Emp;

IF IDsell=0 THEN
	SELECT IDosto INTO IDsell FROM Ostotapahtuma WHERE Kassa=Regis AND Myyjä=Emp;
     INSERT INTO Kuitti VALUES(NULL,CURRENT_TIMESTAMP, CN, PrNm,BarCod, Regis, Emp);
     SELECT LAST_INSERT_ID() INTO IDsell;
END IF;


END$$

DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
